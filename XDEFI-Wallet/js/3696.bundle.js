!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="be7bb7d0-f53e-452d-bc58-f9fb7d645a1f",e._sentryDebugIdIdentifier="sentry-dbid-be7bb7d0-f53e-452d-bc58-f9fb7d645a1f")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"28.2.2"},(self.webpackChunkxdefi_extension=self.webpackChunkxdefi_extension||[]).push([[3696],{623696:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{y8:()=>$});var s=n(264487),o=n(687842),a=n(914096),i=n(90412),l=n(276749),d=n(225071),c=n(409669),u=n.n(c),g=n(244431),m=n.n(g),h=n(831352),f=n(581354),p=n.n(f),y=n(256371),w=n(739989),b=n(496486),v=n(46461),S=n(42763),T=n(556138),C=n(330101),k=n(255357),_=n(730876),x=n(929380),A=n(628790),I=n(630292),Buffer=n(348764).Buffer,D=e([S,I]);[S,I]=D.then?(await D)():D;var P=Object.defineProperty,O=Object.defineProperties,U=Object.getOwnPropertyDescriptors,F=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,L=Math.pow,K=(e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t)=>{for(var n in t||(t={}))N.call(t,n)&&K(e,n,t[n]);if(F)for(var n of F(t))B.call(t,n)&&K(e,n,t[n]);return e},M=(e,t)=>O(e,U(t)),E=(e,t,n)=>(K(e,"symbol"!=typeof t?t+"":t,n),n),Z=(e,t,n)=>new Promise(((r,s)=>{var o=e=>{try{i(n.next(e))}catch(e){s(e)}},a=e=>{try{i(n.throw(e))}catch(e){s(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,a);i((n=n.apply(e,t)).next())}));const j=2.25,R="cw20Token",J={uluna:"LUNA",uaud:"AUT",ucad:"CAT",uchf:"CHT",ucny:"CNT",ueur:"EUT",ugbp:"GBT",uinr:"INT",ujpy:"JPT",ukrw:"KRT",umnt:"MNT",usdr:"SDT",usgd:"SGT",uusd:"UST",udkk:"DKT",uhkd:"HKT",unok:"NOT",usek:"SET",uthb:"THT",uphp:"PHT",uidr:"IDT"},H=/(terra[0-9][a-z0-9]{38})/gi,G=e=>{var t;try{const t=a.Coin.fromString(e),n=t.amount.toString();return{amount:n,denom:t.denom}}catch(n){const r=null==(t=e.match(H))?void 0:t[0],s=e.replace(H,"");if(r&&s)return{amount:s,denom:r}}return null};class $ extends I.NL{constructor(e){super(e),E(this,"clients",{}),E(this,"gasPriceCache"),E(this,"getClient",(()=>{const e=this.getConfig().network;return this.clients[e.network]||(this.clients[e.network]=new a.LCDClient({URL:e.LCD_URL,chainID:e.chainId})),this.clients[e.network]})),E(this,"getWallet",((e,t)=>Z(this,null,(function*(){const{wallets:n}=S.Z.getState().wallets,r=n[e];if(!r)return null;switch(r.walletInfo.type){case T.WalletType.Keystore:{const e=r.walletInfo.data;if(!t)throw(0,v.t)("app:controller_errors.no_credentionals_passed");const n=yield(0,l.decryptFromKeystore)(e.keystore,t.walletPassword);return this.getWalletFromSeed(new _.H(n),e.walletIndex)}case T.WalletType.Ledger:{const e=r.walletInfo.data;return this.getWalletFromKey(new x.z(e))}case T.WalletType.PkKeystore:{const e=r.walletInfo.data;if(!t)throw(0,v.t)("app:controller_errors.no_credentionals_passed");const n=yield(0,A.Jy)(e.keystore,t.walletPassword),s=A.Si.fromString(n);return this.getWalletFromPrivateKey(s.nspk.value.pk)}default:throw"Not supported"}})))),E(this,"sendTx",((e,t,n)=>Z(this,null,(function*(){const r=yield this.getWallet(t,n);if(!r)throw(0,v.t)("app:controller_errors.unable_to_get_wallet");const s=yield this.getFee(e,r),o=yield this.createTransaction(e,s);return(yield this.signAndBroadcastTx(o,t,e.fromAddress,e.toAddress,n)).txhash})))),E(this,"signAndBroadcastTx",((e,t,n,r,s)=>Z(this,null,(function*(){const o=yield this.getWallet(t,s);if(!o)throw(0,v.t)("app:controller_errors.unable_to_get_wallet");e.fee||(e.fee=yield this.getFee({address:"",amount:"",toAddress:r,msgs:e.msgs,fromAddress:n},o));const a=yield o.createAndSignTx(e),i=yield this.getClient().tx.broadcast(a);if(w.Z.debug("broadcasted",i),0===i.height)throw i.raw_log;return i})))),E(this,"getFee",((e,t)=>Z(this,null,(function*(){const n="uluna",r=yield this.getGasPrices(n),s=yield this.estimateGasLimit(e,t),o=new(m())(s).times(r[n]).integerValue(m().ROUND_CEIL).toString(),i=new a.Coins([a.Coin.fromData({amount:o,denom:n})]),l=i;return new a.Fee(s,l)})))),E(this,"getGasPrices",(e=>Z(this,null,(function*(){const t=this.getConfig();if(!this.gasPriceCache){const e=yield fetch(`${t.network.FCD_URL}/v1/txs/gas_prices`,{redirect:"follow"});this.gasPriceCache=yield e.json()}return e?{[e]:this.gasPriceCache[e]}:this.gasPriceCache}))))}getOwnedTokens(e){return Promise.resolve([])}getFees(){throw"Method not implemented."}getConfig(){return this.config}reloadJsonRpcProvidersUrls(){(0,b.noop)()}fcd(e,t){return Z(this,null,(function*(){const n=this.config.network,r=u().create(),s=new URLSearchParams(t).toString(),{data:o}=yield r.get(`${n.FCD_URL}/v1${e}?${s}`);return o}))}getWalletFromPrivateKey(e){const t=new a.RawKey(Buffer.from(e,"hex"));return this.getWalletFromKey(t)}getWalletFromSeed(e,t){const n=new a.MnemonicKey({mnemonic:e.toString(),index:t});return this.getWalletFromKey(n)}getWalletFromKey(e){return new a.Wallet(this.getClient(),e)}getAddress(e){if(!e.seed&&!e.pk||e.pk&&e.seed)throw"getAddress: Wrong arguments";if(e.pk){return{address:new a.RawKey(Buffer.from(e.pk,"hex")).accAddress}}if(e.seed){return{address:new a.MnemonicKey({mnemonic:e.seed.seed.toString(),index:e.seed.walletIndex}).accAddress}}throw"getAddress: Wrong arguments"}getPrivateKey(e){if(!e.seed)throw"getPrivateKey: Wrong arguments";if(e.seed){return new a.MnemonicKey({mnemonic:e.seed.toString(),index:e.walletIndex}).privateKey.toString("hex")}throw"getPrivateKey: wrong arguments"}getChainBalanceStateUpdate(e){return Z(this,null,(function*(){const{wallets:t}=S.Z.getState().wallets,{address:n}=t[e].chainData[this.getId()]||{};if(!n)return{walletId:e,chainId:this.getId(),chainBalance:"0"};try{const[t]=yield this.getClient().bank.balance(n),r=t.toIntCoins().toArray().filter((e=>"uluna"===e.denom)).reduce(((e,t)=>e+t.amount.toNumber()),0);return{walletId:e,chainId:this.getId(),chainBalance:String(r)}}catch(e){throw w.Z.error(e),s.Tb(e),e}}))}getBalance(e){return Z(this,null,(function*(){const[t]=yield this.getClient().bank.balance(e);return t.toIntCoins().toArray().filter((e=>"uluna"===e.denom)).reduce(((e,t)=>e+t.amount.toNumber()),0)}))}getTokenBalancesStateUpdate(e){return Z(this,null,(function*(){var t,n;const{wallets:r}=S.Z.getState().wallets,o=this.config.id,{address:a}=r[e].chainData[o]||{};if(!a)return{walletId:e,chainId:o,tokenBalances:{}};const i=null!=(n=null==(t=r[e].chainData[o])?void 0:t.tokens)?n:{},l=Object.keys(i);try{const t=(yield Promise.allSettled(l.map((e=>Z(this,null,(function*(){const t=i[e],n=t.denom||J[t.address]?yield this.getDenomBalance(t.denom||t.address||t.id,a):yield this.getTokenBalance(t.address,a);return M(W({},t),{balance:n})})))))).reduce(((e,t,n)=>{if("fulfilled"!==t.status)return s.Tb("Unsettled promise for balances",{extra:{currVal:t,token:i[l[n]]}}),e;const r=t.value,o=r.address?r.address:r.id;return M(W({},e),{[null==o?void 0:o.toLowerCase()]:r})}),{});return{walletId:e,chainId:o,tokenBalances:t}}catch(e){throw w.Z.error({e}),s.Tb(e),e}}))}getTokenBalance(e,t){return Z(this,null,(function*(){return(yield this.getClient().wasm.contractQuery(e,{balance:{address:t}})).balance}))}getDenomBalance(e,t){return Z(this,null,(function*(){const[n]=yield this.getClient().bank.balance(t);return n.toIntCoins().toArray().filter((t=>t.denom===e)).reduce(((e,t)=>e+t.amount.toNumber()),0)}))}getTokens(){var e;const t=S.Z.getState(),{wallets:{wallets:n,activeWalletId:r}}=t,s=n[r],o=null==(e=null==s?void 0:s.chainData[this.config.id])?void 0:e.tokens;return null!=o?o:[]}getAssetIcon(e){if(!e)return this.getConfig().fallbackImage;const t=null==e?void 0:e.toLowerCase();if(-1!==["uluna","luna"].indexOf(t))return this.getConfig().image;const n=this.getToken(t);return n&&n.image?n.image:this.getConfig().fallbackImage}getToken(e){const t=null==e?void 0:e.toUpperCase(),n=this.getTokens();return n?Object.values(n).find((e=>{var n,r,s;return(null==(n=e.address)?void 0:n.toUpperCase())===t||(null==(r=e.id)?void 0:r.toUpperCase())===t||(null==(s=e.symbol)?void 0:s.toUpperCase())===t})):null}getTxIO(e,t){const n=[],r=[],s=(e,t,n,r)=>{e.forEach((e=>{const s=G(e.trim());s&&t.push(M(W({},s),{sender:n,recipient:r}))}))};return t&&t.forEach((t=>{var o,a;t&&("multiSend"===(null==(a=null==(o=t[0])?void 0:o.transformed)?void 0:a.type)||t.forEach((t=>{var o,a,i,l;const d=null==(a=null==(o=t.transformed)?void 0:o.amount)?void 0:a.split(","),c=null==(i=t.transformed)?void 0:i.sender,u=null==(l=t.transformed)?void 0:l.recipient;d&&(e===c&&s(d,r,c,u),e===u&&s(d,n,c,u))})))})),[n,r]}getTransactions(){return Z(this,null,(function*(){const{activeWalletId:e,wallets:t}=S.Z.getState().wallets,{address:n}=t[e].chainData[this.config.id]||{};if(n)try{const t=yield this.fcd("/txs",{account:n,limit:100});w.Z.debug({msg:"TerraController::updateTransactions",transactions:t.txs});const r=(0,o.Y4)(),s=(0,o.Zs)(r),i=t.txs.reduce(((e,t)=>{var r,i;if(!t.tx)return e;const l=a.Tx.fromData(t.tx),d=(0,o.F7)(JSON.stringify(M(W({},t),{tx:l.toData()})),s,n);if(!d)return e;const{txhash:c,timestamp:u}=t,g=l.code?"failed":"successful",[m,h]=this.getTxIO(n,d),f=[];if(h.length>0){const e=this.getToken(h[0].denom),t=null!=(r=null==e?void 0:e.decimals)?r:this.getConfig().decimals;f.push({isSender:!0,status:g,date:new Date(u),from:h[0].sender,to:h[0].recipient,action:"send",hash:c,amount:(0,y.formatUnits)(h[0].amount,t),symbol:this.getTokenSymbol(h[0].denom),icon:this.getAssetIcon(h[0].denom),chainId:this.config.id})}if(m.length>0){const e=this.getToken(m[0].denom),t=null!=(i=null==e?void 0:e.decimals)?i:this.getConfig().decimals;f.push({isSender:!1,status:g,date:new Date(u),from:m[0].sender,to:m[0].recipient,action:"receive",hash:c,amount:(0,y.formatUnits)(m[0].amount,t),symbol:this.getTokenSymbol(m[0].denom),icon:this.getAssetIcon(m[0].denom),chainId:this.config.id})}return[...e,...f]}),[]).filter((e=>null!==e));i.length&&(yield(0,k.h4)({walletId:e,transactions:i,chainId:this.getId()}))}catch(e){throw w.Z.error({e}),s.Tb(e),e}}))}validateAddress(e){return $.validateAddress(e)}static validateAddress(e){return a.AccAddress.validate(e)}approveDappTransaction(e,t,n){return Z(this,null,(function*(){var r;const s=yield this.getWallet(t,n);if(!s)throw(0,v.t)("app:controller_errors.wallet_does_not_exist");if(this.getId()!==e.chainId)throw(0,v.t)("app:controller_errors.dapp_mesage_must_be_active_network");const o=I.j8.getFromAccountIMessage(e),a=e.raw.params;if(e.raw.method===h.e5.SignBytes){const{wallets:e}=S.Z.getState().wallets,{address:n}=e[t].chainData[this.config.id]||{};if(n===o){const e=Buffer.from(Object.values(null==a?void 0:a.bytes)),t=yield s.key.sign(e);return{public_key:null==(r=s.key.publicKey)?void 0:r.toData(),signature:t}}throw(0,v.t)("app:controller_errors.wrong_terra_address")}const{msgs:i,fee:l}=this.parseCreateTxOptions(a);let d=l;d||(d=yield this.getFee({address:"",amount:"",toAddress:"",msgs:i,fromAddress:a.from,gasAdjustment:a.gasAdjustment,gasPrice:a.gasPrices},s));const c=yield s.createAndSignTx({memo:null==a?void 0:a.memo,msgs:i,fee:d});if(e.raw.method===h.e5.Sign)return c;if(!o)throw(0,v.t)("app:controller_errors.unable_to_get_wallet_address");return yield this.getClient().tx.broadcast(c)}))}updateBalance(){return Z(this,arguments,(function*(e=S.Z.getState().wallets.activeWalletId){try{const[t,n]=yield Promise.allSettled([this.getChainBalanceStateUpdate(e),this.getTokenBalancesStateUpdate(e)]);if("fulfilled"===t.status)return"fulfilled"===n.status?{chainBalanceStateUpdate:t.value,tokenBalancesStateUpdate:n.value}:(w.Z.error("Terra error updating token balances"),{chainBalanceStateUpdate:t.value});throw w.Z.error("Terra error updating chain balance"),(0,v.t)("app:controller_errors.terra_error_updating_chain_balance")}catch(e){throw w.Z.error(e),s.Tb(e),e}}))}validateTx(e){const t={};return""===e?t.toAddress="Address is required":this.validateAddress(e)||(t.toAddress="Address is not valid."),t}isDenom(e){return!(!e||!e.length)&&!1===H.test(e)}createTransaction(e,t){return Z(this,null,(function*(){var n,r;const s=t?t.amount.denoms():["uluna"],o={memo:e.memo,fee:t,msgs:[],gasAdjustment:null!=(n=e.gasAdjustment)?n:j,feeDenoms:s};if(o.gasPrices=e.gasPrice?[a.Coin.fromString(String(e.gasPrice))]:yield this.getGasPrices(),e.msgs)o.msgs=e.msgs;else if(!e.address.length||this.isDenom(e.address)){const t=new(m())(e.amount).multipliedBy(L(10,this.getConfig().decimals)).toString();o.msgs=[new a.MsgSend(e.fromAddress,e.toAddress,[new a.Coin(e.address.length?e.address:"uluna",t)])]}else{const t=this.getToken(e.address),n=null!=(r=null==t?void 0:t.decimals)?r:this.getConfig().decimals,s=new(m())(e.amount).multipliedBy(L(10,n)).toString();o.msgs=[new a.MsgExecuteContract(e.fromAddress,e.address,{transfer:{recipient:e.toAddress,amount:s}})]}return o}))}denomToSymbol(e){return"uluna"===e?"LUNA":"ibc/"===e.substring(0,4)?R:void 0!==J[e]?J[e]+"":e}getTokenSymbol(e){if(!e)return this.denomToSymbol("uluna");if("uluna"===e)return"LUNA";if(void 0!==J[e])return J[e]+"";const t=this.getToken(e);return t?t.symbol:R}getSymbolFromMsg(e,t){var n,r,s,o,a,i,l,d;w.Z.debug({fct:"getSymbolFromMsg",msg:e});const c=e.toData()["@type"];if(-1!==c.indexOf("MsgExecuteContract")){const{wallets:t,activeWalletId:i}=S.Z.getState().wallets,l=e.toData(!1),d=null==(r=null==(n=t[i])?void 0:n.chainData[this.config.id])?void 0:r.tokens;if(d){const e=l.contract,t=Object.values(d).find((t=>{var n,r;return(null==(n=t.address)?void 0:n.toUpperCase())===(null==e?void 0:e.toUpperCase())||(null==(r=t.id)?void 0:r.toUpperCase())===(null==e?void 0:e.toUpperCase())}));if(t)return t.symbol}const c=null!=(a=null==(s=l.coins)?void 0:s[0])?a:null==(o=l.funds)?void 0:o[0];return c?this.denomToSymbol(c.denom):R}if(-1!==c.indexOf("MsgSend")){const t=e.toData();if(null==(i=t.amount)?void 0:i[0])return this.denomToSymbol(t.amount[0].denom)}return(null==(d=null==(l=null==t?void 0:t.amount)?void 0:l[0])?void 0:d.denom)?this.denomToSymbol(t.amount[0].denom):"LUNA"}getTransactionsDetails({transactions:e,senderAddress:t,assetCode:n,tokens:r}){const s=[];return e.forEach((e=>{var n;const o=(null==(n=e.from[0].from)?void 0:n.toLowerCase())===(null==t?void 0:t.toLowerCase()),a=(0,y.formatUnits)(e.to[0].amount.amount,e.to[0].amount.decimal);let i=e.asset.symbol,l=d.toString();if(i){if(-1!==["LUNA","LUNA"].indexOf(i))l=this.getConfig().image;else if(r&&r[i]){const e=r[i];l=e.image?e.image:d.toString()}i=this.denomToSymbol(i)}s.push({prefix:o?"-":"+",icon:l,dateInfo:new Date(e.date),isSender:o,toAddress:e.to[0].to||"",fromAddress:e.from[0].from||"",balance:a,assetSymbol:i,hash:e.hash,txQueryString:"terra/transaction"})})),s.filter((e=>!n||n===e.assetSymbol)).sort(((e,t)=>t.dateInfo-e.dateInfo))}getSignerData(e){return Z(this,null,(function*(){const t=this.getClient(),n=yield t.auth.accountInfo(e),r=n.getSequenceNumber();return{publicKey:n.getPublicKey(),sequenceNumber:r}}))}getFeeDenom(e){let t="uluna";return this.isDenom(e.address)&&(t=e.address),t}estimateGasLimit(e,t){return Z(this,null,(function*(){if(!t)return 2e5;try{const n=new i.LCDClient({"phoenix-1":{lcd:"https://phoenix-lcd.terra.dev",chainID:"phoenix-1",gasAdjustment:1.75,gasPrices:{uluna:.015},prefix:"terra"}});return(yield n.tx.create([{address:t.key.accAddress}],M(W({},e),{msgs:e.msgs,chainID:"phoenix-1"}))).auth_info.fee.gas_limit}catch(e){return w.Z.error({fct:"estimateGasLimit",error:e}),2e5}}))}getTaxRate(){return Z(this,null,(function*(){const e=this.getConfig();return(yield(0,C.Io)(`${e.FCD_URL}/terra/treasury/v1beta1/tax_rate`)).tax_rate}))}getTokenInfo(e){return Z(this,null,(function*(){return(yield(0,C.Io)(`${this.config.network.FCD_URL}/wasm/contracts/${e}/store?query_msg=${JSON.stringify({token_info:{}})}`)).result}))}isSignMessage(e){return"sign"===e.raw.method}parseCreateTxOptions(e){return $.parseCreateTxOptions(e)}static parseCreateTxOptions(e){const{msgs:t,fee:n}=e,r="@type"in JSON.parse(t[0]),s="execute_msg"in JSON.parse(t[0]);return M(W({},e),{msgs:t.map((e=>r?a.Msg.fromData(JSON.parse(e),s):a.Msg.fromAmino(JSON.parse(e),s))),fee:(e=>{if(e)return r?a.Fee.fromData(JSON.parse(e)):a.Fee.fromAmino(JSON.parse(e))})(n)})}subFee(e,t){return $.subFee(e,t)}static getMsgType(e){var t;const n=e.toData();return null!=(t=n["@type"])?t:n.type}static subFee(e,t){for(const n of e){const e=$.getMsgType(n);if(-1!==e.indexOf("MsgExecuteContract")){const e=n,r=e.coins.get(t.denom);if(void 0!==r&&r.amount.gte(t.amount))return void e.coins.set(t.denom,r.amount.sub(t.amount))}else if(e.indexOf("MsgSend")){const e=n,r=e.amount.get(t.denom);if(void 0!==r&&r.amount.gte(t.amount))return void e.amount.set(t.denom,r.amount.sub(t.amount))}}throw(0,v.t)("app:controller_errors.unable_to_find_message_denom_amount",{denom:t.denom,amount:t.amount.toString()})}static encrypt(e,t){try{const n=p().lib.WordArray.random(16),r=p().PBKDF2(t,n,{keySize:8,iterations:100,hasher:p().algo.SHA1}),s=p().lib.WordArray.random(16),o=p().AES.encrypt(e,r,{iv:s,padding:p().pad.Pkcs7,mode:p().mode.CBC});return n.toString()+s.toString()+o.toString()}catch(e){return""}}static wrapEncrypt(e,t,n){const r={name:"xdefi_exported_key",encrypted_key:$.encrypt(t,n),address:e};return Buffer.from(JSON.stringify(r)).toString("base64")}static wrapDecrypt(e,t){const n=JSON.parse(Buffer.from(e,"base64").toString("utf8"));return $.decrypt(n.encrypted_key,t)}static decrypt(e,t){try{const n=p().enc.Hex.parse(e.substr(0,32)),r=p().enc.Hex.parse(e.substr(32,32)),s=e.substring(64),o=p().PBKDF2(t,n,{keySize:8,iterations:100,hasher:p().algo.SHA1});return p().AES.decrypt(s,o,{iv:r,padding:p().pad.Pkcs7,mode:p().mode.CBC}).toString(p().enc.Utf8)}catch(e){return""}}}r()}catch(e){r(e)}}))}}]);
//# sourceMappingURL=3696.bundle.js.map